<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráfico de Amplitude</title>
    <style>
        /* CSS para estilização */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #chart-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 400px;
            width: 100%;
            margin-top: 20px;
            border: 1px solid #ddd;
            position: relative;
        }
        .bar {
            width: 30px;
            background-color: #3498db;
            margin: 0 5px;
            cursor: pointer;
            transition: height 0.2s, margin-bottom 0.2s;
            position: relative;
        }
        .bar.negative {
            background-color: #e74c3c;
            bottom: 0; /* Posiciona a barra negativa a partir do fundo */
        }
    </style>
</head>
<body>
    <div id="chart-container"></div>
    <script>
        // JavaScript para gerar e controlar o gráfico
        const chartContainer = document.getElementById('chart-container');
        const numBars = 10;
        const bars = [];
        const minAmplitude = -50;
        const maxAmplitude = 50;

        // Função para gerar valores aleatórios com suavidade
        function generateRandomValues() {
            let values = [];
            for (let i = 0; i < numBars; i++) {
                let randomValue = Math.floor(Math.random() * 10) + 20; // Valores entre 20 e 30
                randomValue *= Math.random() > 0.5 ? 1 : -1; // Aleatoriamente positivo ou negativo
                values.push(randomValue);
            }
            return values;
        }

        // Função para criar o gráfico
        function createChart(values) {
            chartContainer.innerHTML = ''; // Limpa o container
            values.forEach((value, index) => {
                const bar = document.createElement('div');
                bar.classList.add('bar');
                bar.style.height = `${Math.abs(value)}%`;
                bar.classList.toggle('negative', value < 0);
                bar.dataset.value = value;
                bar.dataset.index = index;

                // Define a posição da barra negativa
                if (value < 0) {
                    bar.style.marginBottom = `${Math.abs(value)}%`;
                }

                bar.addEventListener('click', () => editBar(index));
                chartContainer.appendChild(bar);
                bars.push(bar);
            });
        }

        // Função para editar a barra selecionada
        function editBar(index) {
            const currentBar = bars[index];
            const currentValue = parseInt(currentBar.dataset.value, 10);
            const newValue = parseInt(prompt('Digite o novo valor da barra:', currentValue), 10);
            if (isNaN(newValue)) return;

            // Calcula a diferença e distribui para as vizinhas
            const difference = currentValue - newValue;
            distributeDifference(index, difference);

            // Atualiza os valores e o gráfico
            updateChart();
        }

        // Função para distribuir a diferença entre as barras vizinhas
        function distributeDifference(index, difference) {
            const leftIndex = index > 0 ? index - 1 : null;
            const rightIndex = index < bars.length - 1 ? index + 1 : null;

            if (leftIndex !== null && rightIndex !== null) {
                adjustBarValue(leftIndex, difference / 2);
                adjustBarValue(rightIndex, difference / 2);
            } else if (leftIndex !== null) {
                adjustBarValue(leftIndex, difference);
            } else if (rightIndex !== null) {
                adjustBarValue(rightIndex, difference);
            }
        }

        // Função para ajustar o valor da barra e garantir que o valor esteja dentro dos limites
        function adjustBarValue(index, adjustment) {
            const bar = bars[index];
            let newValue = parseInt(bar.dataset.value, 10) + adjustment;

            // Ajusta a amplitude conforme o valor positivo ou negativo
            newValue = newValue > maxAmplitude ? maxAmplitude : newValue < minAmplitude ? minAmplitude : newValue;
            bar.dataset.value = newValue;
        }

        // Função para atualizar o gráfico após edições
        function updateChart() {
            bars.forEach(bar => {
                const value = parseInt(bar.dataset.value, 10);
                bar.style.height = `${Math.abs(value)}%`;

                if (value < 0) {
                    bar.style.marginBottom = `${Math.abs(value)}%`;
                    bar.classList.add('negative');
                } else {
                    bar.style.marginBottom = '0'; // Remove margem para barras positivas
                    bar.classList.remove('negative');
                }
            });
        }

        // Gera os valores iniciais e cria o gráfico
        const initialValues = generateRandomValues();
        createChart(initialValues);
    </script>
</body>
</html>
